{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport Stripe from 'stripe';\nvar stripe = new Stripe(process.env.NEXT_PUBLIC_STRIPE_SECRET_KEY);\nexport default function handler(req, res) {\n  var params, session;\n  return _regeneratorRuntime.async(function handler$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (!(req.method === 'POST')) {\n            _context.next = 15;\n            break;\n          }\n\n          console.log(req.body.cartItems);\n          _context.prev = 2;\n          params = {\n            submit_type: 'pay',\n            mode: 'payment',\n            payment_method_types: ['card'],\n            billing_address_collection: 'auto',\n            shipping_options: [{\n              shipping_rate: 'shr_1M3iqbHoKGSSL2Bg07LC8fGV'\n            }, {\n              shipping_rate: 'shr_1M3isIHoKGSSL2Bgq2IryjIN'\n            }],\n            line_items: req.body.map(function (item) {\n              var img = item.image[0].asset._ref;\n              var newImage = img.replace('image-', 'https://cdn.sanity.io/images/vfxfwnaw/production/').replace('-webp', '.webp');\n              return {\n                price_data: {\n                  currency: 'usd',\n                  product_data: {\n                    name: item.name,\n                    images: [newImage]\n                  },\n                  unit_amount: item.price * 100\n                },\n                adjustable_quantity: {\n                  enabled: true,\n                  minimum: 1\n                },\n                quantity: item.quantity\n              };\n            }),\n            success_url: req.headers.origin + \"/success\",\n            cancel_url: req.headers.origin + \"/canceled\"\n          };\n          _context.next = 6;\n          return _regeneratorRuntime.awrap(stripe.checkout.sessions.create(params));\n\n        case 6:\n          session = _context.sent;\n          res.status(200).json(session);\n          _context.next = 13;\n          break;\n\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context[\"catch\"](2);\n          res.status(_context.t0.statusCode || 500).json(_context.t0.message);\n\n        case 13:\n          _context.next = 17;\n          break;\n\n        case 15:\n          res.setHeader('Allow', 'POST');\n          res.status(405).end('Method Not Allowed');\n\n        case 17:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[2, 10]], Promise);\n}","map":{"version":3,"names":["Stripe","stripe","process","env","NEXT_PUBLIC_STRIPE_SECRET_KEY","handler","req","res","method","console","log","body","cartItems","params","submit_type","mode","payment_method_types","billing_address_collection","shipping_options","shipping_rate","line_items","map","item","img","image","asset","_ref","newImage","replace","price_data","currency","product_data","name","images","unit_amount","price","adjustable_quantity","enabled","minimum","quantity","success_url","headers","origin","cancel_url","checkout","sessions","create","session","status","json","statusCode","message","setHeader","end"],"sources":["C:/Users/PC/Desktop/All/StoreApp2/my-app/api/stripe.js"],"sourcesContent":["import Stripe from 'stripe';\r\n\r\nconst stripe = new Stripe(process.env.NEXT_PUBLIC_STRIPE_SECRET_KEY);\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method === 'POST') {\r\n    console.log(req.body.cartItems);\r\n\r\n    \r\n    try {\r\n      const params = {\r\n        submit_type: 'pay',\r\n        mode: 'payment',\r\n        payment_method_types: ['card'],\r\n        billing_address_collection: 'auto',\r\n        shipping_options: [\r\n          { shipping_rate: 'shr_1M3iqbHoKGSSL2Bg07LC8fGV' },\r\n          { shipping_rate:'shr_1M3isIHoKGSSL2Bgq2IryjIN'}\r\n        ],\r\n        line_items: req.body.map((item) => {\r\n          const img = item.image[0].asset._ref;\r\n          const newImage = img.replace('image-', 'https://cdn.sanity.io/images/vfxfwnaw/production/').replace('-webp', '.webp');\r\n\r\n          return {\r\n            price_data: { \r\n              currency: 'usd',\r\n              product_data: { \r\n                name: item.name,\r\n                images: [newImage],\r\n              },\r\n              unit_amount: item.price * 100,\r\n            },\r\n            adjustable_quantity: {\r\n              enabled:true,\r\n              minimum: 1,\r\n            },\r\n            quantity: item.quantity\r\n          }\r\n        }),\r\n        success_url: `${req.headers.origin}/success`,\r\n        cancel_url: `${req.headers.origin}/canceled`,\r\n      }\r\n\r\n      // Create Checkout Sessions from body params.\r\n      const session = await stripe.checkout.sessions.create(params);\r\n\r\n      res.status(200).json(session);\r\n    } catch (err) {\r\n      res.status(err.statusCode || 500).json(err.message);\r\n    }\r\n  } else {\r\n    res.setHeader('Allow', 'POST');\r\n    res.status(405).end('Method Not Allowed');\r\n  }\r\n}"],"mappings":";AAAA,OAAOA,MAAP,MAAmB,QAAnB;AAEA,IAAMC,MAAM,GAAG,IAAID,MAAJ,CAAWE,OAAO,CAACC,GAAR,CAAYC,6BAAvB,CAAf;AAEA,eAAe,SAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B;EAAA;EAAA;IAAA;MAAA;QAAA;UAAA,MACTD,GAAG,CAACE,MAAJ,KAAe,MADN;YAAA;YAAA;UAAA;;UAEXC,OAAO,CAACC,GAAR,CAAYJ,GAAG,CAACK,IAAJ,CAASC,SAArB;UAFW;UAMHC,MANG,GAMM;YACbC,WAAW,EAAE,KADA;YAEbC,IAAI,EAAE,SAFO;YAGbC,oBAAoB,EAAE,CAAC,MAAD,CAHT;YAIbC,0BAA0B,EAAE,MAJf;YAKbC,gBAAgB,EAAE,CAChB;cAAEC,aAAa,EAAE;YAAjB,CADgB,EAEhB;cAAEA,aAAa,EAAC;YAAhB,CAFgB,CALL;YASbC,UAAU,EAAEd,GAAG,CAACK,IAAJ,CAASU,GAAT,CAAa,UAACC,IAAD,EAAU;cACjC,IAAMC,GAAG,GAAGD,IAAI,CAACE,KAAL,CAAW,CAAX,EAAcC,KAAd,CAAoBC,IAAhC;cACA,IAAMC,QAAQ,GAAGJ,GAAG,CAACK,OAAJ,CAAY,QAAZ,EAAsB,mDAAtB,EAA2EA,OAA3E,CAAmF,OAAnF,EAA4F,OAA5F,CAAjB;cAEA,OAAO;gBACLC,UAAU,EAAE;kBACVC,QAAQ,EAAE,KADA;kBAEVC,YAAY,EAAE;oBACZC,IAAI,EAAEV,IAAI,CAACU,IADC;oBAEZC,MAAM,EAAE,CAACN,QAAD;kBAFI,CAFJ;kBAMVO,WAAW,EAAEZ,IAAI,CAACa,KAAL,GAAa;gBANhB,CADP;gBASLC,mBAAmB,EAAE;kBACnBC,OAAO,EAAC,IADW;kBAEnBC,OAAO,EAAE;gBAFU,CAThB;gBAaLC,QAAQ,EAAEjB,IAAI,CAACiB;cAbV,CAAP;YAeD,CAnBW,CATC;YA6BbC,WAAW,EAAKlC,GAAG,CAACmC,OAAJ,CAAYC,MAAjB,aA7BE;YA8BbC,UAAU,EAAKrC,GAAG,CAACmC,OAAJ,CAAYC,MAAjB;UA9BG,CANN;UAAA;UAAA,iCAwCazC,MAAM,CAAC2C,QAAP,CAAgBC,QAAhB,CAAyBC,MAAzB,CAAgCjC,MAAhC,CAxCb;;QAAA;UAwCHkC,OAxCG;UA0CTxC,GAAG,CAACyC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,OAArB;UA1CS;UAAA;;QAAA;UAAA;UAAA;UA4CTxC,GAAG,CAACyC,MAAJ,CAAW,YAAIE,UAAJ,IAAkB,GAA7B,EAAkCD,IAAlC,CAAuC,YAAIE,OAA3C;;QA5CS;UAAA;UAAA;;QAAA;UA+CX5C,GAAG,CAAC6C,SAAJ,CAAc,OAAd,EAAuB,MAAvB;UACA7C,GAAG,CAACyC,MAAJ,CAAW,GAAX,EAAgBK,GAAhB,CAAoB,oBAApB;;QAhDW;QAAA;UAAA;MAAA;IAAA;EAAA;AAAA"},"metadata":{},"sourceType":"module"}